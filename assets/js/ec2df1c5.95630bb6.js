"use strict";(globalThis.webpackChunkmy_docs=globalThis.webpackChunkmy_docs||[]).push([[722],{513(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Performance-and-Optimization","title":"Performance and Optimization Best Practices","description":"Overview","source":"@site/docs/Performance-and-Optimization.md","sourceDirName":".","slug":"/Performance-and-Optimization","permalink":"/django-rest-best-practices/Performance-and-Optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/pragnakalp/django-rest-best-practices/tree/main/docs/Performance-and-Optimization.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Security Best Practices","permalink":"/django-rest-best-practices/Security-Best-Practices"},"next":{"title":"API Versioning & Architecture Best Practices","permalink":"/django-rest-best-practices/API-Versioning"}}');var s=i(4848),t=i(8453);const l={},a="Performance and Optimization Best Practices",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Database Query Optimization",id:"database-query-optimization",level:2},{value:"The N+1 Query Problem",id:"the-n1-query-problem",level:3},{value:"Understanding the Problem",id:"understanding-the-problem",level:4},{value:"Comparing N+1 Solutions: select_related() vs prefetch_related()",id:"comparing-n1-solutions-select_related-vs-prefetch_related",level:3},{value:"Approach 1: select_related() (SQL JOIN)",id:"approach-1-select_related-sql-join",level:4},{value:"Approach 2: prefetch_related() (Separate Queries)",id:"approach-2-prefetch_related-separate-queries",level:4},{value:"Decision Matrix: select_related vs prefetch_related",id:"decision-matrix-select_related-vs-prefetch_related",level:4},{value:"When to Use Each",id:"when-to-use-each",level:4},{value:"Combining Both (Best Practice)",id:"combining-both-best-practice",level:4},{value:"Advanced: Prefetch with Custom Querysets",id:"advanced-prefetch-with-custom-querysets",level:4},{value:"Common Mistakes to Avoid",id:"common-mistakes-to-avoid",level:4},{value:"Combining select_related() and prefetch_related()",id:"combining-select_related-and-prefetch_related",level:3},{value:"Prefetch with Custom Querysets",id:"prefetch-with-custom-querysets",level:3},{value:"Serializer Optimization",id:"serializer-optimization",level:2},{value:"Avoid Heavy Operations in SerializerMethodField",id:"avoid-heavy-operations-in-serializermethodfield",level:3},{value:"Use only() and defer()",id:"use-only-and-defer",level:3},{value:"Different Serializers for Different Actions",id:"different-serializers-for-different-actions",level:3},{value:"Pagination",id:"pagination",level:2},{value:"Why Pagination is Critical",id:"why-pagination-is-critical",level:3},{value:"Configure Default Pagination",id:"configure-default-pagination",level:3},{value:"Custom Pagination Classes",id:"custom-pagination-classes",level:3},{value:"Page Number Pagination",id:"page-number-pagination",level:4},{value:"Limit/Offset Pagination",id:"limitoffset-pagination",level:4},{value:"Cursor Pagination (Best for Large Datasets)",id:"cursor-pagination-best-for-large-datasets",level:4},{value:"Caching Strategies: Choosing the Right Approach",id:"caching-strategies-choosing-the-right-approach",level:2},{value:"Comparing Caching Approaches",id:"comparing-caching-approaches",level:3},{value:"Approach 1: View-Level Caching (Simplest)",id:"approach-1-view-level-caching-simplest",level:4},{value:"Approach 2: Low-Level Caching (More Control)",id:"approach-2-low-level-caching-more-control",level:4},{value:"Approach 3: Query-Level Caching (Database)",id:"approach-3-query-level-caching-database",level:4},{value:"Approach 4: Redis with django-redis (Production)",id:"approach-4-redis-with-django-redis-production",level:4},{value:"Approach 5: CDN/HTTP Caching (Edge Caching)",id:"approach-5-cdnhttp-caching-edge-caching",level:4},{value:"Decision Matrix for Caching",id:"decision-matrix-for-caching",level:3},{value:"When to Use Each Caching Strategy",id:"when-to-use-each-caching-strategy",level:3},{value:"Cache Invalidation Strategies",id:"cache-invalidation-strategies",level:3},{value:"Strategy 1: Time-Based (TTL)",id:"strategy-1-time-based-ttl",level:4},{value:"Strategy 2: Event-Based (Signals)",id:"strategy-2-event-based-signals",level:4},{value:"Strategy 3: Cache Versioning",id:"strategy-3-cache-versioning",level:4},{value:"Strategy 4: Cache Tags (Advanced)",id:"strategy-4-cache-tags-advanced",level:4},{value:"Layered Caching Strategy (Best Practice)",id:"layered-caching-strategy-best-practice",level:3},{value:"Database Indexing",id:"database-indexing",level:2},{value:"Add Indexes to Frequently Queried Fields",id:"add-indexes-to-frequently-queried-fields",level:3},{value:"Aggregation and Annotation",id:"aggregation-and-annotation",level:2},{value:"Use Database Aggregations",id:"use-database-aggregations",level:3},{value:"Conditional Aggregation",id:"conditional-aggregation",level:3},{value:"Bulk Operations",id:"bulk-operations",level:2},{value:"Bulk Create",id:"bulk-create",level:3},{value:"Bulk Update",id:"bulk-update",level:3},{value:"Asynchronous Tasks",id:"asynchronous-tasks",level:2},{value:"Use Celery for Heavy Operations",id:"use-celery-for-heavy-operations",level:3},{value:"Background Processing",id:"background-processing",level:3},{value:"Response Optimization",id:"response-optimization",level:2},{value:"Compress Responses",id:"compress-responses",level:3},{value:"Optimize JSON Rendering",id:"optimize-json-rendering",level:3},{value:"Connection Pooling",id:"connection-pooling",level:2},{value:"Database Connection Pooling",id:"database-connection-pooling",level:3},{value:"Monitoring and Profiling",id:"monitoring-and-profiling",level:2},{value:"Django Debug Toolbar",id:"django-debug-toolbar",level:3},{value:"Query Counting Middleware",id:"query-counting-middleware",level:3},{value:"Performance Logging",id:"performance-logging",level:3},{value:"Performance Testing",id:"performance-testing",level:2},{value:"Load Testing with Locust",id:"load-testing-with-locust",level:3},{value:"Summary",id:"summary",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"performance-and-optimization-best-practices",children:"Performance and Optimization Best Practices"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"This document covers best practices for building high-performance Django REST Framework APIs that scale efficiently and provide fast response times."}),"\n",(0,s.jsx)(n.h2,{id:"database-query-optimization",children:"Database Query Optimization"}),"\n",(0,s.jsx)(n.h3,{id:"the-n1-query-problem",children:"The N+1 Query Problem"}),"\n",(0,s.jsx)(n.h4,{id:"understanding-the-problem",children:"Understanding the Problem"}),"\n",(0,s.jsx)(n.p,{children:"The N+1 query problem occurs when you fetch a list of objects and then access related objects for each item, causing N additional queries."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example of N+1 Problem:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# This causes N+1 queries\nclass ArticleSerializer(serializers.ModelSerializer):\n    author_name = serializers.CharField(source='author.username')\n    \n    class Meta:\n        model = Article\n        fields = ['id', 'title', 'author_name']\n\n# View\narticles = Article.objects.all()  # 1 query\nserializer = ArticleSerializer(articles, many=True)\n# For each article, accessing author.username causes 1 query = N queries\n# Total: 1 + N queries\n"})}),"\n",(0,s.jsx)(n.h3,{id:"comparing-n1-solutions-select_related-vs-prefetch_related",children:"Comparing N+1 Solutions: select_related() vs prefetch_related()"}),"\n",(0,s.jsx)(n.h4,{id:"approach-1-select_related-sql-join",children:"Approach 1: select_related() (SQL JOIN)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best For:"})," ForeignKey and OneToOne relationships"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class ArticleViewSet(viewsets.ModelViewSet):\n    serializer_class = ArticleSerializer\n    \n    def get_queryset(self):\n        # Single query with SQL JOIN\n        return Article.objects.select_related('author', 'category')\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"How It Works:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Creates SQL JOIN in single query"}),"\n",(0,s.jsx)(n.li,{children:"Fetches related objects in one database hit"}),"\n",(0,s.jsx)(n.li,{children:"Returns combined result set"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"SQL Generated:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT article.*, author.*, category.*\nFROM article\nINNER JOIN user AS author ON article.author_id = author.id\nINNER JOIN category ON article.category_id = category.id\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Single database query"}),"\n",(0,s.jsx)(n.li,{children:"Fastest for small to medium datasets"}),"\n",(0,s.jsx)(n.li,{children:"Simple to understand"}),"\n",(0,s.jsx)(n.li,{children:"Minimal memory overhead"}),"\n",(0,s.jsx)(n.li,{children:"Works with filtering on related fields"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Only works with ForeignKey/OneToOne"}),"\n",(0,s.jsx)(n.li,{children:"Can create large result sets with multiple JOINs"}),"\n",(0,s.jsx)(n.li,{children:"Cartesian product with multiple relationships"}),"\n",(0,s.jsx)(n.li,{children:"Not suitable for ManyToMany"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use When:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ForeignKey relationships (author, category)"}),"\n",(0,s.jsx)(n.li,{children:"OneToOneField relationships (profile)"}),"\n",(0,s.jsx)(n.li,{children:"Forward relationships only"}),"\n",(0,s.jsx)(n.li,{children:"Need to filter on related fields"}),"\n",(0,s.jsx)(n.li,{children:"Small to medium number of related objects"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Performance:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Without select_related: 101 queries\narticles = Article.objects.all()  # 1 query\nfor article in articles:  # 100 articles\n    print(article.author.username)  # 100 queries\n# Total: 101 queries, ~500ms\n\n# With select_related: 1 query\narticles = Article.objects.select_related('author').all()\nfor article in articles:\n    print(article.author.username)  # No queries\n# Total: 1 query, ~5ms\n"})}),"\n",(0,s.jsx)(n.h4,{id:"approach-2-prefetch_related-separate-queries",children:"Approach 2: prefetch_related() (Separate Queries)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best For:"})," ManyToMany and reverse ForeignKey relationships"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class ArticleViewSet(viewsets.ModelViewSet):\n    serializer_class = ArticleSerializer\n    \n    def get_queryset(self):\n        # 2 separate queries, joined in Python\n        return Article.objects.prefetch_related('tags', 'comments')\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"How It Works:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Executes separate queries for each relationship"}),"\n",(0,s.jsx)(n.li,{children:"Joins results in Python memory"}),"\n",(0,s.jsx)(n.li,{children:"Caches related objects"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"SQL Generated:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Query 1: Get articles\nSELECT * FROM article\n\n-- Query 2: Get all related tags\nSELECT * FROM tag\nINNER JOIN article_tags ON tag.id = article_tags.tag_id\nWHERE article_tags.article_id IN (1, 2, 3, ...)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Works with ManyToMany relationships"}),"\n",(0,s.jsx)(n.li,{children:"Works with reverse ForeignKey"}),"\n",(0,s.jsx)(n.li,{children:"No cartesian product issues"}),"\n",(0,s.jsx)(n.li,{children:"Can prefetch multiple relationships efficiently"}),"\n",(0,s.jsx)(n.li,{children:"Supports custom querysets (filtering)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Multiple database queries (but still efficient)"}),"\n",(0,s.jsx)(n.li,{children:"More memory usage (caches in Python)"}),"\n",(0,s.jsx)(n.li,{children:"Cannot filter on prefetched fields in database"}),"\n",(0,s.jsx)(n.li,{children:"Slightly slower than select_related for simple cases"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use When:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ManyToManyField relationships (tags, categories)"}),"\n",(0,s.jsx)(n.li,{children:"Reverse ForeignKey relationships (comments, ratings)"}),"\n",(0,s.jsx)(n.li,{children:"GenericRelation"}),"\n",(0,s.jsx)(n.li,{children:"Need to prefetch filtered related objects"}),"\n",(0,s.jsx)(n.li,{children:"Multiple related objects per parent"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Performance:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Without prefetch_related: 101 queries\narticles = Article.objects.all()  # 1 query\nfor article in articles:  # 100 articles\n    print(article.tags.all())  # 100 queries\n# Total: 101 queries, ~500ms\n\n# With prefetch_related: 2 queries\narticles = Article.objects.prefetch_related('tags').all()\nfor article in articles:\n    print(article.tags.all())  # No queries\n# Total: 2 queries, ~10ms\n"})}),"\n",(0,s.jsx)(n.h4,{id:"decision-matrix-select_related-vs-prefetch_related",children:"Decision Matrix: select_related vs prefetch_related"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Criteria"}),(0,s.jsx)(n.th,{children:"select_related"}),(0,s.jsx)(n.th,{children:"prefetch_related"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Relationship Type"})}),(0,s.jsx)(n.td,{children:"ForeignKey, OneToOne"}),(0,s.jsx)(n.td,{children:"ManyToMany, Reverse FK"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Number of Queries"})}),(0,s.jsx)(n.td,{children:"1 (JOIN)"}),(0,s.jsx)(n.td,{children:"2+ (separate)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Memory Usage"})}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"Medium"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Speed"})}),(0,s.jsx)(n.td,{children:"Fastest"}),(0,s.jsx)(n.td,{children:"Fast"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Filtering"})}),(0,s.jsx)(n.td,{children:"Can filter in DB"}),(0,s.jsx)(n.td,{children:"Filter before prefetch"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Complexity"})}),(0,s.jsx)(n.td,{children:"Simple"}),(0,s.jsx)(n.td,{children:"Medium"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Cartesian Product"})}),(0,s.jsx)(n.td,{children:"Possible"}),(0,s.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"when-to-use-each",children:"When to Use Each"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use select_related() when:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u2713 ForeignKey relationships (article.author)\n\u2713 OneToOneField relationships (user.profile)\n\u2713 Forward relationships only\n\u2713 Need to filter on related fields\n\u2713 Want single query\n\u2713 Small number of JOINs (< 3)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use prefetch_related() when:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u2713 ManyToManyField (article.tags)\n\u2713 Reverse ForeignKey (article.comments)\n\u2713 Multiple related objects\n\u2713 Need filtered related objects\n\u2713 Avoiding cartesian products\n\u2713 GenericRelation\n"})}),"\n",(0,s.jsx)(n.h4,{id:"combining-both-best-practice",children:"Combining Both (Best Practice)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class ArticleViewSet(viewsets.ModelViewSet):\n    def get_queryset(self):\n        return Article.objects.select_related(\n            'author',           # ForeignKey - use select_related\n            'category'          # ForeignKey - use select_related\n        ).prefetch_related(\n            'tags',             # ManyToMany - use prefetch_related\n            'comments',         # Reverse FK - use prefetch_related\n            'comments__author'  # Nested: prefetch comments, select author\n        )\n\n# Result: 3 queries instead of 100+\n# Query 1: Articles with author and category (JOIN)\n# Query 2: All tags for these articles\n# Query 3: All comments with authors for these articles\n"})}),"\n",(0,s.jsx)(n.h4,{id:"advanced-prefetch-with-custom-querysets",children:"Advanced: Prefetch with Custom Querysets"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from django.db.models import Prefetch\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def get_queryset(self):\n        # Only prefetch approved comments, ordered by date\n        approved_comments = Comment.objects.filter(\n            approved=True\n        ).select_related('author').order_by('-created_at')\n        \n        return Article.objects.select_related(\n            'author'\n        ).prefetch_related(\n            Prefetch('comments', queryset=approved_comments),\n            'tags'\n        )\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Why This is Better:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Filters comments in database (not Python)"}),"\n",(0,s.jsx)(n.li,{children:"Orders comments efficiently"}),"\n",(0,s.jsx)(n.li,{children:"Combines select_related within prefetch"}),"\n",(0,s.jsx)(n.li,{children:"Total queries: 3 (articles+author, comments+author, tags)"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"common-mistakes-to-avoid",children:"Common Mistakes to Avoid"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Mistake 1: Using select_related on ManyToMany"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# WRONG - select_related doesn't work with ManyToMany\nArticle.objects.select_related('tags')  # Ignored!\n\n# CORRECT\nArticle.objects.prefetch_related('tags')\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Mistake 2: Accessing Related Objects Without Optimization"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# BAD - N+1 queries\narticles = Article.objects.all()\nfor article in articles:\n    print(article.author.name)  # Query per article\n    print(article.tags.count())  # Query per article\n\n# GOOD - 3 queries total\narticles = Article.objects.select_related('author').prefetch_related('tags')\nfor article in articles:\n    print(article.author.name)  # No query\n    print(article.tags.count())  # No query\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Mistake 3: Over-optimizing"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# BAD - Fetching data you don't use\nArticle.objects.select_related(\n    'author', 'category', 'publisher', 'editor'\n).prefetch_related(\n    'tags', 'comments', 'ratings', 'bookmarks'\n)  # If you only need author and tags, this is wasteful\n\n# GOOD - Only fetch what you need\nArticle.objects.select_related('author').prefetch_related('tags')\n"})}),"\n",(0,s.jsx)(n.h3,{id:"combining-select_related-and-prefetch_related",children:"Combining select_related() and prefetch_related()"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class ArticleViewSet(viewsets.ModelViewSet):\n    serializer_class = ArticleSerializer\n    \n    def get_queryset(self):\n        return Article.objects.select_related(\n            'author',           # ForeignKey\n            'category'          # ForeignKey\n        ).prefetch_related(\n            'tags',             # ManyToMany\n            'comments',         # Reverse ForeignKey\n            'comments__author'  # Nested relationship\n        )\n"})}),"\n",(0,s.jsx)(n.h3,{id:"prefetch-with-custom-querysets",children:"Prefetch with Custom Querysets"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from django.db.models import Prefetch\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def get_queryset(self):\n        # Only prefetch approved comments\n        approved_comments = Comment.objects.filter(approved=True)\n        \n        return Article.objects.prefetch_related(\n            Prefetch('comments', queryset=approved_comments)\n        ).select_related('author')\n"})}),"\n",(0,s.jsx)(n.h2,{id:"serializer-optimization",children:"Serializer Optimization"}),"\n",(0,s.jsx)(n.h3,{id:"avoid-heavy-operations-in-serializermethodfield",children:"Avoid Heavy Operations in SerializerMethodField"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Bad Practice:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class ArticleSerializer(serializers.ModelSerializer):\n    comment_count = serializers.SerializerMethodField()\n    \n    def get_comment_count(self, obj):\n        # Database query for EACH article\n        return obj.comments.count()  # N queries!\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Good Practice:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# In ViewSet\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def get_queryset(self):\n        # Annotate in queryset - single query\n        return Article.objects.annotate(\n            comment_count=Count('comments')\n        )\n\n# In Serializer\nclass ArticleSerializer(serializers.ModelSerializer):\n    comment_count = serializers.IntegerField(read_only=True)\n    \n    class Meta:\n        model = Article\n        fields = ['id', 'title', 'comment_count']\n"})}),"\n",(0,s.jsx)(n.h3,{id:"use-only-and-defer",children:"Use only() and defer()"}),"\n",(0,s.jsx)(n.p,{children:"Fetch only the fields you need."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# only() - Fetch only specified fields\nclass ArticleListView(generics.ListAPIView):\n    def get_queryset(self):\n        # Only fetch id, title, created_at\n        return Article.objects.only('id', 'title', 'created_at')\n\n# defer() - Fetch all fields except specified\nclass ArticleListView(generics.ListAPIView):\n    def get_queryset(self):\n        # Fetch all fields except content (large text field)\n        return Article.objects.defer('content')\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use Case:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"List views with minimal data"}),"\n",(0,s.jsx)(n.li,{children:"Avoiding large text/blob fields"}),"\n",(0,s.jsx)(n.li,{children:"Reducing database load"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"different-serializers-for-different-actions",children:"Different Serializers for Different Actions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class ArticleListSerializer(serializers.ModelSerializer):\n    \"\"\"Minimal serializer for list view\"\"\"\n    class Meta:\n        model = Article\n        fields = ['id', 'title', 'author', 'created_at']\n\nclass ArticleDetailSerializer(serializers.ModelSerializer):\n    \"\"\"Full serializer for detail view\"\"\"\n    author = UserSerializer(read_only=True)\n    comments = CommentSerializer(many=True, read_only=True)\n    \n    class Meta:\n        model = Article\n        fields = ['id', 'title', 'content', 'author', 'comments', 'created_at', 'updated_at']\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def get_serializer_class(self):\n        if self.action == 'list':\n            return ArticleListSerializer\n        return ArticleDetailSerializer\n    \n    def get_queryset(self):\n        if self.action == 'list':\n            return Article.objects.select_related('author').only(\n                'id', 'title', 'author__username', 'created_at'\n            )\n        return Article.objects.select_related('author').prefetch_related('comments')\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pagination",children:"Pagination"}),"\n",(0,s.jsx)(n.h3,{id:"why-pagination-is-critical",children:"Why Pagination is Critical"}),"\n",(0,s.jsx)(n.p,{children:"Without pagination, large datasets can:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cause memory issues"}),"\n",(0,s.jsx)(n.li,{children:"Slow response times"}),"\n",(0,s.jsx)(n.li,{children:"Enable DoS attacks"}),"\n",(0,s.jsx)(n.li,{children:"Overwhelm clients"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"configure-default-pagination",children:"Configure Default Pagination"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# settings.py\nREST_FRAMEWORK = {\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',\n    'PAGE_SIZE': 20\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"custom-pagination-classes",children:"Custom Pagination Classes"}),"\n",(0,s.jsx)(n.h4,{id:"page-number-pagination",children:"Page Number Pagination"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rest_framework.pagination import PageNumberPagination\n\nclass StandardResultsSetPagination(PageNumberPagination):\n    page_size = 20\n    page_size_query_param = 'page_size'\n    max_page_size = 100\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    queryset = Article.objects.all()\n    serializer_class = ArticleSerializer\n    pagination_class = StandardResultsSetPagination\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GET /articles/?page=2\nGET /articles/?page=2&page_size=50\n"})}),"\n",(0,s.jsx)(n.h4,{id:"limitoffset-pagination",children:"Limit/Offset Pagination"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rest_framework.pagination import LimitOffsetPagination\n\nclass CustomLimitOffsetPagination(LimitOffsetPagination):\n    default_limit = 20\n    max_limit = 100\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    pagination_class = CustomLimitOffsetPagination\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GET /articles/?limit=20&offset=40\n"})}),"\n",(0,s.jsx)(n.h4,{id:"cursor-pagination-best-for-large-datasets",children:"Cursor Pagination (Best for Large Datasets)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rest_framework.pagination import CursorPagination\n\nclass ArticleCursorPagination(CursorPagination):\n    page_size = 20\n    ordering = '-created_at'  # Must have ordering\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    pagination_class = ArticleCursorPagination\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Consistent pagination even with new data"}),"\n",(0,s.jsx)(n.li,{children:"Better performance for large datasets"}),"\n",(0,s.jsx)(n.li,{children:"Prevents duplicate/missing items"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"caching-strategies-choosing-the-right-approach",children:"Caching Strategies: Choosing the Right Approach"}),"\n",(0,s.jsx)(n.h3,{id:"comparing-caching-approaches",children:"Comparing Caching Approaches"}),"\n",(0,s.jsx)(n.h4,{id:"approach-1-view-level-caching-simplest",children:"Approach 1: View-Level Caching (Simplest)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best For:"})," Static or semi-static content, public endpoints"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from django.utils.decorators import method_decorator\nfrom django.views.decorators.cache import cache_page\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    @method_decorator(cache_page(60 * 15))  # Cache for 15 minutes\n    def list(self, request, *args, **kwargs):\n        return super().list(request, *args, **kwargs)\n    \n    @method_decorator(cache_page(60 * 60))  # Cache for 1 hour\n    def retrieve(self, request, *args, **kwargs):\n        return super().retrieve(request, *args, **kwargs)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Extremely simple (one decorator)"}),"\n",(0,s.jsx)(n.li,{children:"Caches entire HTTP response"}),"\n",(0,s.jsx)(n.li,{children:"Includes headers"}),"\n",(0,s.jsx)(n.li,{children:"Works with Django's cache framework"}),"\n",(0,s.jsx)(n.li,{children:"Minimal code changes"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"All-or-nothing caching"}),"\n",(0,s.jsx)(n.li,{children:"Same cache for all users (unless varied)"}),"\n",(0,s.jsx)(n.li,{children:"Hard to invalidate selectively"}),"\n",(0,s.jsx)(n.li,{children:"Can't cache parts of response"}),"\n",(0,s.jsx)(n.li,{children:"Query parameters affect cache key"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use When:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Public, read-only endpoints"}),"\n",(0,s.jsx)(n.li,{children:"Content changes infrequently"}),"\n",(0,s.jsx)(n.li,{children:"Same response for all users"}),"\n",(0,s.jsx)(n.li,{children:"Simple caching needs"}),"\n",(0,s.jsx)(n.li,{children:"Quick wins needed"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Performance Impact:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Without cache: 50ms per request\n# With cache: 2ms per request (25x faster)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"approach-2-low-level-caching-more-control",children:"Approach 2: Low-Level Caching (More Control)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best For:"})," Selective caching, complex invalidation logic"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from django.core.cache import cache\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def list(self, request, *args, **kwargs):\n        # Build cache key based on filters\n        cache_key = f\'article_list_{request.query_params.get("category", "all")}\'\n        cached_data = cache.get(cache_key)\n        \n        if cached_data is not None:\n            return Response(cached_data)\n        \n        queryset = self.filter_queryset(self.get_queryset())\n        serializer = self.get_serializer(queryset, many=True)\n        \n        cache.set(cache_key, serializer.data, 60 * 15)\n        return Response(serializer.data)\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Fine-grained control"}),"\n",(0,s.jsx)(n.li,{children:"Cache specific data (not full response)"}),"\n",(0,s.jsx)(n.li,{children:"Custom cache keys"}),"\n",(0,s.jsx)(n.li,{children:"Selective invalidation"}),"\n",(0,s.jsx)(n.li,{children:"Can cache querysets, serialized data, or computed values"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"More code to write"}),"\n",(0,s.jsx)(n.li,{children:"Must handle cache keys manually"}),"\n",(0,s.jsx)(n.li,{children:"Must implement invalidation"}),"\n",(0,s.jsx)(n.li,{children:"Easy to make mistakes"}),"\n",(0,s.jsx)(n.li,{children:"More maintenance"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use When:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Need custom cache keys"}),"\n",(0,s.jsx)(n.li,{children:"Selective invalidation required"}),"\n",(0,s.jsx)(n.li,{children:"Caching computed values"}),"\n",(0,s.jsx)(n.li,{children:"Different cache times per data type"}),"\n",(0,s.jsx)(n.li,{children:"Complex caching logic"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Performance Impact:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Without cache: 100ms (complex query)\n# With cache: 1ms (from Redis)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"approach-3-query-level-caching-database",children:"Approach 3: Query-Level Caching (Database)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best For:"})," Expensive database queries, aggregations"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from django.core.cache import cache\nfrom django.db.models import Count\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def get_queryset(self):\n        cache_key = 'article_stats'\n        stats = cache.get(cache_key)\n        \n        if stats is None:\n            stats = Article.objects.aggregate(\n                total=Count('id'),\n                published=Count('id', filter=Q(published=True))\n            )\n            cache.set(cache_key, stats, 60 * 5)  # 5 minutes\n        \n        return Article.objects.all()\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Caches expensive queries"}),"\n",(0,s.jsx)(n.li,{children:"Reduces database load"}),"\n",(0,s.jsx)(n.li,{children:"Can cache aggregations"}),"\n",(0,s.jsx)(n.li,{children:"Transparent to views"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Only caches query results"}),"\n",(0,s.jsx)(n.li,{children:"Doesn't cache serialization"}),"\n",(0,s.jsx)(n.li,{children:"Still processes data"}),"\n",(0,s.jsx)(n.li,{children:"Complex invalidation"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use When:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Expensive aggregations"}),"\n",(0,s.jsx)(n.li,{children:"Complex queries"}),"\n",(0,s.jsx)(n.li,{children:"Database is bottleneck"}),"\n",(0,s.jsx)(n.li,{children:"Multiple views use same query"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"approach-4-redis-with-django-redis-production",children:"Approach 4: Redis with django-redis (Production)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best For:"})," High-traffic production systems"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# settings.py\nCACHES = {\n    'default': {\n        'BACKEND': 'django_redis.cache.RedisCache',\n        'LOCATION': 'redis://127.0.0.1:6379/1',\n        'OPTIONS': {\n            'CLIENT_CLASS': 'django_redis.client.DefaultClient',\n            'PARSER_CLASS': 'redis.connection.HiredisParser',\n            'CONNECTION_POOL_CLASS_KWARGS': {\n                'max_connections': 50,\n            },\n        },\n        'KEY_PREFIX': 'myapp',\n        'TIMEOUT': 300,\n    }\n}\n\n# Usage (same as low-level caching)\nfrom django_redis import get_redis_connection\n\nredis_conn = get_redis_connection(\"default\")\nredis_conn.setex('key', 300, 'value')\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Fast (in-memory)"}),"\n",(0,s.jsx)(n.li,{children:"Distributed (shared across servers)"}),"\n",(0,s.jsx)(n.li,{children:"Persistent (survives restarts)"}),"\n",(0,s.jsx)(n.li,{children:"Advanced features (pub/sub, atomic operations)"}),"\n",(0,s.jsx)(n.li,{children:"Production-ready"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"External dependency (Redis)"}),"\n",(0,s.jsx)(n.li,{children:"Infrastructure complexity"}),"\n",(0,s.jsx)(n.li,{children:"Memory management needed"}),"\n",(0,s.jsx)(n.li,{children:"Cost (if hosted)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use When:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Production environments"}),"\n",(0,s.jsx)(n.li,{children:"Multi-server deployment"}),"\n",(0,s.jsx)(n.li,{children:"High traffic (1000+ req/s)"}),"\n",(0,s.jsx)(n.li,{children:"Need distributed cache"}),"\n",(0,s.jsx)(n.li,{children:"Already using Redis"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"approach-5-cdnhttp-caching-edge-caching",children:"Approach 5: CDN/HTTP Caching (Edge Caching)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best For:"})," Static content, global distribution"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rest_framework.response import Response\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def list(self, request, *args, **kwargs):\n        response = super().list(request, *args, **kwargs)\n        \n        # Set cache headers for CDN\n        response['Cache-Control'] = 'public, max-age=3600'\n        response['Vary'] = 'Accept-Language'\n        \n        return response\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Caches at edge (closest to users)"}),"\n",(0,s.jsx)(n.li,{children:"Reduces server load completely"}),"\n",(0,s.jsx)(n.li,{children:"Global distribution"}),"\n",(0,s.jsx)(n.li,{children:"Fastest possible response"}),"\n",(0,s.jsx)(n.li,{children:"Scales infinitely"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Only works for GET requests"}),"\n",(0,s.jsx)(n.li,{children:"Public data only"}),"\n",(0,s.jsx)(n.li,{children:"Invalidation is hard"}),"\n",(0,s.jsx)(n.li,{children:"Requires CDN setup"}),"\n",(0,s.jsx)(n.li,{children:"Cost"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use When:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Public APIs"}),"\n",(0,s.jsx)(n.li,{children:"Global user base"}),"\n",(0,s.jsx)(n.li,{children:"Static content"}),"\n",(0,s.jsx)(n.li,{children:"High traffic"}),"\n",(0,s.jsx)(n.li,{children:"Budget allows"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"decision-matrix-for-caching",children:"Decision Matrix for Caching"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Criteria"}),(0,s.jsx)(n.th,{children:"View-Level"}),(0,s.jsx)(n.th,{children:"Low-Level"}),(0,s.jsx)(n.th,{children:"Query-Level"}),(0,s.jsx)(n.th,{children:"Redis"}),(0,s.jsx)(n.th,{children:"CDN"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Complexity"})}),(0,s.jsx)(n.td,{children:"\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Control"})}),(0,s.jsx)(n.td,{children:"\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Performance"})}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Scalability"})}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50\u2b50\u2b50"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Setup Time"})}),(0,s.jsx)(n.td,{children:"5 min"}),(0,s.jsx)(n.td,{children:"30 min"}),(0,s.jsx)(n.td,{children:"20 min"}),(0,s.jsx)(n.td,{children:"2 hours"}),(0,s.jsx)(n.td,{children:"4 hours"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Cost"})}),(0,s.jsx)(n.td,{children:"Free"}),(0,s.jsx)(n.td,{children:"Free"}),(0,s.jsx)(n.td,{children:"Free"}),(0,s.jsx)(n.td,{children:"$"}),(0,s.jsx)(n.td,{children:"$$$"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"when-to-use-each-caching-strategy",children:"When to Use Each Caching Strategy"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use View-Level Caching when:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u2713 Quick wins needed\n\u2713 Public endpoints\n\u2713 Simple requirements\n\u2713 Same response for all users\n\u2713 Content changes infrequently\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use Low-Level Caching when:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u2713 Need fine-grained control\n\u2713 Custom cache keys required\n\u2713 Selective invalidation needed\n\u2713 Caching computed values\n\u2713 Complex caching logic\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use Query-Level Caching when:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u2713 Expensive database queries\n\u2713 Complex aggregations\n\u2713 Database is bottleneck\n\u2713 Same query used multiple times\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use Redis when:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u2713 Production environment\n\u2713 Multi-server deployment\n\u2713 High traffic\n\u2713 Need distributed cache\n\u2713 Advanced features needed\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use CDN when:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u2713 Global user base\n\u2713 Public content\n\u2713 Very high traffic\n\u2713 Static or semi-static data\n\u2713 Budget allows\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cache-invalidation-strategies",children:"Cache Invalidation Strategies"}),"\n",(0,s.jsx)(n.h4,{id:"strategy-1-time-based-ttl",children:"Strategy 1: Time-Based (TTL)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Simple: Cache expires after time\ncache.set('key', value, 60 * 15)  # 15 minutes\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Pros:"})," Simple, automatic\n",(0,s.jsx)(n.strong,{children:"Cons:"})," Stale data until expiration\n",(0,s.jsx)(n.strong,{children:"Use When:"})," Data changes predictably"]}),"\n",(0,s.jsx)(n.h4,{id:"strategy-2-event-based-signals",children:"Strategy 2: Event-Based (Signals)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from django.db.models.signals import post_save, post_delete\n\n@receiver([post_save, post_delete], sender=Article)\ndef invalidate_cache(sender, instance, **kwargs):\n    cache.delete('article_list')\n    cache.delete(f'article_{instance.id}')\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Pros:"})," Immediate invalidation\n",(0,s.jsx)(n.strong,{children:"Cons:"})," More complex, can miss cases\n",(0,s.jsx)(n.strong,{children:"Use When:"})," Data changes unpredictably"]}),"\n",(0,s.jsx)(n.h4,{id:"strategy-3-cache-versioning",children:"Strategy 3: Cache Versioning"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"CACHE_VERSION = 1\n\ncache_key = f'article_list_v{CACHE_VERSION}'\ncache.set(cache_key, data, timeout=None)  # Never expires\n\n# To invalidate: increment CACHE_VERSION\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Pros:"})," No explicit invalidation needed\n",(0,s.jsx)(n.strong,{children:"Cons:"})," Old cache remains in memory\n",(0,s.jsx)(n.strong,{children:"Use When:"})," Deployment-based invalidation"]}),"\n",(0,s.jsx)(n.h4,{id:"strategy-4-cache-tags-advanced",children:"Strategy 4: Cache Tags (Advanced)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Tag-based invalidation\ncache.set('article_1', data, tags=['articles', 'user_123'])\ncache.delete_many(tags=['articles'])  # Invalidate all articles\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Pros:"})," Flexible, group invalidation\n",(0,s.jsx)(n.strong,{children:"Cons:"})," Requires special cache backend\n",(0,s.jsx)(n.strong,{children:"Use When:"})," Complex invalidation patterns"]}),"\n",(0,s.jsx)(n.h3,{id:"layered-caching-strategy-best-practice",children:"Layered Caching Strategy (Best Practice)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Layer 1: CDN (edge caching) - 1 hour\n# Layer 2: Redis (application caching) - 15 minutes  \n# Layer 3: Database query optimization\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def list(self, request, *args, **kwargs):\n        # Layer 2: Redis cache\n        cache_key = 'article_list'\n        cached_data = cache.get(cache_key)\n        \n        if cached_data:\n            response = Response(cached_data)\n        else:\n            # Layer 3: Optimized query\n            queryset = Article.objects.select_related('author').prefetch_related('tags')\n            serializer = self.get_serializer(queryset, many=True)\n            cache.set(cache_key, serializer.data, 60 * 15)\n            response = Response(serializer.data)\n        \n        # Layer 1: CDN headers\n        response['Cache-Control'] = 'public, max-age=3600'\n        return response\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Why Layered Caching:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"CDN serves most requests (fastest)"}),"\n",(0,s.jsx)(n.li,{children:"Redis serves cache misses (fast)"}),"\n",(0,s.jsx)(n.li,{children:"Database only hit on cache miss (rare)"}),"\n",(0,s.jsx)(n.li,{children:"Different TTLs per layer"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"database-indexing",children:"Database Indexing"}),"\n",(0,s.jsx)(n.h3,{id:"add-indexes-to-frequently-queried-fields",children:"Add Indexes to Frequently Queried Fields"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from django.db import models\n\nclass Article(models.Model):\n    title = models.CharField(max_length=200, db_index=True)\n    slug = models.SlugField(unique=True, db_index=True)\n    author = models.ForeignKey(User, on_delete=models.CASCADE, db_index=True)\n    created_at = models.DateTimeField(auto_now_add=True, db_index=True)\n    published = models.BooleanField(default=False, db_index=True)\n    \n    class Meta:\n        indexes = [\n            models.Index(fields=['author', 'published']),\n            models.Index(fields=['-created_at']),\n            models.Index(fields=['published', '-created_at']),\n        ]\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"When to Add Indexes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Fields used in ",(0,s.jsx)(n.code,{children:"filter()"})]}),"\n",(0,s.jsxs)(n.li,{children:["Fields used in ",(0,s.jsx)(n.code,{children:"order_by()"})]}),"\n",(0,s.jsx)(n.li,{children:"Foreign keys (automatic in Django)"}),"\n",(0,s.jsxs)(n.li,{children:["Fields used in ",(0,s.jsx)(n.code,{children:"WHERE"})," clauses"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"When NOT to Add Indexes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Small tables"}),"\n",(0,s.jsx)(n.li,{children:"Fields that are rarely queried"}),"\n",(0,s.jsx)(n.li,{children:"Fields with low cardinality (few unique values)"}),"\n",(0,s.jsx)(n.li,{children:"Write-heavy tables (indexes slow down writes)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"aggregation-and-annotation",children:"Aggregation and Annotation"}),"\n",(0,s.jsx)(n.h3,{id:"use-database-aggregations",children:"Use Database Aggregations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from django.db.models import Count, Avg, Sum, Max, Min\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def get_queryset(self):\n        return Article.objects.annotate(\n            comment_count=Count('comments'),\n            average_rating=Avg('ratings__score'),\n            total_views=Sum('views'),\n            latest_comment=Max('comments__created_at')\n        )\n\nclass ArticleSerializer(serializers.ModelSerializer):\n    comment_count = serializers.IntegerField(read_only=True)\n    average_rating = serializers.FloatField(read_only=True)\n    \n    class Meta:\n        model = Article\n        fields = ['id', 'title', 'comment_count', 'average_rating']\n"})}),"\n",(0,s.jsx)(n.h3,{id:"conditional-aggregation",children:"Conditional Aggregation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from django.db.models import Q, Count, Case, When, IntegerField\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def get_queryset(self):\n        return Article.objects.annotate(\n            approved_comment_count=Count(\n                'comments',\n                filter=Q(comments__approved=True)\n            ),\n            pending_comment_count=Count(\n                'comments',\n                filter=Q(comments__approved=False)\n            )\n        )\n"})}),"\n",(0,s.jsx)(n.h2,{id:"bulk-operations",children:"Bulk Operations"}),"\n",(0,s.jsx)(n.h3,{id:"bulk-create",children:"Bulk Create"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Bad - Multiple database hits\nfor item in data:\n    Article.objects.create(**item)\n\n# Good - Single database hit\narticles = [Article(**item) for item in data]\nArticle.objects.bulk_create(articles, batch_size=100)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"bulk-update",children:"Bulk Update"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from django.db.models import F\n\n# Bad - Multiple queries\nfor article in articles:\n    article.views += 1\n    article.save()\n\n# Good - Single query\nArticle.objects.filter(id__in=article_ids).update(views=F('views') + 1)\n\n# Or with bulk_update\nfor article in articles:\n    article.views += 1\nArticle.objects.bulk_update(articles, ['views'], batch_size=100)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"asynchronous-tasks",children:"Asynchronous Tasks"}),"\n",(0,s.jsx)(n.h3,{id:"use-celery-for-heavy-operations",children:"Use Celery for Heavy Operations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from celery import shared_task\n\n@shared_task\ndef generate_report(article_id):\n    \"\"\"Heavy operation - run asynchronously\"\"\"\n    article = Article.objects.get(id=article_id)\n    # Generate report...\n    return report_data\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    @action(detail=True, methods=['post'])\n    def generate_report(self, request, pk=None):\n        article = self.get_object()\n        \n        # Queue task asynchronously\n        task = generate_report.delay(article.id)\n        \n        return Response({\n            'status': 'Report generation started',\n            'task_id': task.id\n        }, status=status.HTTP_202_ACCEPTED)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"background-processing",children:"Background Processing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'@shared_task\ndef send_notification_emails(article_id):\n    """Send emails in background"""\n    article = Article.objects.get(id=article_id)\n    subscribers = article.author.followers.all()\n    \n    for subscriber in subscribers:\n        send_email(subscriber.email, article)\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def perform_create(self, serializer):\n        article = serializer.save()\n        # Don\'t wait for emails to be sent\n        send_notification_emails.delay(article.id)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"response-optimization",children:"Response Optimization"}),"\n",(0,s.jsx)(n.h3,{id:"compress-responses",children:"Compress Responses"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# settings.py\nMIDDLEWARE = [\n    'django.middleware.gzip.GZipMiddleware',  # Add this\n    'django.middleware.common.CommonMiddleware',\n    # ... other middleware\n]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"optimize-json-rendering",children:"Optimize JSON Rendering"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from rest_framework.renderers import JSONRenderer\nimport orjson\n\nclass OrjsonRenderer(JSONRenderer):\n    """Faster JSON rendering with orjson"""\n    def render(self, data, accepted_media_type=None, renderer_context=None):\n        return orjson.dumps(data)\n\n# settings.py\nREST_FRAMEWORK = {\n    \'DEFAULT_RENDERER_CLASSES\': [\n        \'myapp.renderers.OrjsonRenderer\',\n    ],\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,s.jsx)(n.h3,{id:"database-connection-pooling",children:"Database Connection Pooling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# settings.py\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql',\n        'NAME': 'mydb',\n        'USER': 'myuser',\n        'PASSWORD': 'mypassword',\n        'HOST': 'localhost',\n        'PORT': '5432',\n        'CONN_MAX_AGE': 600,  # Connection pooling\n        'OPTIONS': {\n            'connect_timeout': 10,\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"monitoring-and-profiling",children:"Monitoring and Profiling"}),"\n",(0,s.jsx)(n.h3,{id:"django-debug-toolbar",children:"Django Debug Toolbar"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# settings.py (development only)\nif DEBUG:\n    INSTALLED_APPS += ['debug_toolbar']\n    MIDDLEWARE += ['debug_toolbar.middleware.DebugToolbarMiddleware']\n    INTERNAL_IPS = ['127.0.0.1']\n"})}),"\n",(0,s.jsx)(n.h3,{id:"query-counting-middleware",children:"Query Counting Middleware"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class QueryCountDebugMiddleware:\n    def __init__(self, get_response):\n        self.get_response = get_response\n\n    def __call__(self, request):\n        from django.db import connection\n        from django.db import reset_queries\n        \n        reset_queries()\n        \n        response = self.get_response(request)\n        \n        if settings.DEBUG:\n            print(f\"Total queries: {len(connection.queries)}\")\n            for query in connection.queries:\n                print(f\"{query['time']}: {query['sql']}\")\n        \n        return response\n"})}),"\n",(0,s.jsx)(n.h3,{id:"performance-logging",children:"Performance Logging"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import time\nimport logging\n\nlogger = logging.getLogger(__name__)\n\nclass PerformanceLoggingMixin:\n    def dispatch(self, request, *args, **kwargs):\n        start_time = time.time()\n        response = super().dispatch(request, *args, **kwargs)\n        duration = time.time() - start_time\n        \n        logger.info(\n            f"{request.method} {request.path} - {response.status_code} - {duration:.2f}s"\n        )\n        \n        return response\n\nclass ArticleViewSet(PerformanceLoggingMixin, viewsets.ModelViewSet):\n    queryset = Article.objects.all()\n    serializer_class = ArticleSerializer\n'})}),"\n",(0,s.jsx)(n.h2,{id:"performance-testing",children:"Performance Testing"}),"\n",(0,s.jsx)(n.h3,{id:"load-testing-with-locust",children:"Load Testing with Locust"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from locust import HttpUser, task, between\n\nclass APIUser(HttpUser):\n    wait_time = between(1, 3)\n    \n    def on_start(self):\n        # Login\n        response = self.client.post("/api/auth/login/", {\n            "username": "testuser",\n            "password": "testpass"\n        })\n        self.token = response.json()[\'token\']\n    \n    @task(3)\n    def list_articles(self):\n        self.client.get(\n            "/api/articles/",\n            headers={"Authorization": f"Token {self.token}"}\n        )\n    \n    @task(1)\n    def create_article(self):\n        self.client.post(\n            "/api/articles/",\n            json={"title": "Test Article", "content": "Test content"},\n            headers={"Authorization": f"Token {self.token}"}\n        )\n'})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"Key performance optimization practices:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Query Optimization:"})," Use ",(0,s.jsx)(n.code,{children:"select_related()"})," and ",(0,s.jsx)(n.code,{children:"prefetch_related()"})," to avoid N+1 queries"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Serializer Efficiency:"})," Avoid heavy operations in ",(0,s.jsx)(n.code,{children:"SerializerMethodField"}),", use annotations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pagination:"})," Always paginate list endpoints, use cursor pagination for large datasets"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Caching:"})," Implement view-level and low-level caching with proper invalidation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Indexing:"})," Add database indexes on frequently queried fields"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Aggregation:"})," Use database aggregations instead of Python loops"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bulk Operations:"})," Use ",(0,s.jsx)(n.code,{children:"bulk_create()"})," and ",(0,s.jsx)(n.code,{children:"bulk_update()"})," for multiple records"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Async Tasks:"})," Move heavy operations to background tasks with Celery"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Response Compression:"})," Enable GZip compression"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitoring:"})," Use profiling tools and logging to identify bottlenecks"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Following these practices ensures your API performs well under load and scales efficiently."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>a});var r=i(6540);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);