"use strict";(globalThis.webpackChunkmy_docs=globalThis.webpackChunkmy_docs||[]).push([[518],{4728(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Error-Handling-and-Status-Codes","title":"Production-Grade Error Handling and Status Codes","description":"Overview","source":"@site/docs/Error-Handling-and-Status-Codes.md","sourceDirName":".","slug":"/Error-Handling-and-Status-Codes","permalink":"/django-rest-best-practices/Error-Handling-and-Status-Codes","draft":false,"unlisted":false,"editUrl":"https://github.com/pragnakalp/django-rest-best-practices/tree/main/docs/Error-Handling-and-Status-Codes.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"API Documentation Best Practices","permalink":"/django-rest-best-practices/API-Documentation-Best-Practices"},"next":{"title":"Testing Best Practices","permalink":"/django-rest-best-practices/Testing-Best-Practices"}}');var i=r(4848),t=r(8453);const o={},l="Production-Grade Error Handling and Status Codes",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Core Principles",id:"core-principles",level:2},{value:"1. Single Error Response Format",id:"1-single-error-response-format",level:3},{value:"2. Thin Views, Rich Services",id:"2-thin-views-rich-services",level:3},{value:"3. Machine-Readable Error Codes",id:"3-machine-readable-error-codes",level:3},{value:"4. Safe Logging Practices",id:"4-safe-logging-practices",level:3},{value:"HTTP Status Codes",id:"http-status-codes",level:2},{value:"Understanding Status Code Categories",id:"understanding-status-code-categories",level:3},{value:"Status Code Strategy",id:"status-code-strategy",level:3},{value:"Production-Grade Error Handling",id:"production-grade-error-handling",level:2},{value:"1. Domain Exceptions (Business Logic Errors)",id:"1-domain-exceptions-business-logic-errors",level:3},{value:"2. Service Layer (No Try/Except in Views)",id:"2-service-layer-no-tryexcept-in-views",level:3},{value:"3. Thin Views (No Business Try/Except)",id:"3-thin-views-no-business-tryexcept",level:3},{value:"4. Global Exception Handler (Single Error Format)",id:"4-global-exception-handler-single-error-format",level:3},{value:"5. Standard Error Codes",id:"5-standard-error-codes",level:3},{value:"6. Safe Logging Practices",id:"6-safe-logging-practices",level:3},{value:"7. Error Response Examples",id:"7-error-response-examples",level:3},{value:"Common Status Codes",id:"common-status-codes",level:2},{value:"2xx Success Codes",id:"2xx-success-codes",level:3},{value:"200 OK",id:"200-ok",level:4},{value:"201 Created",id:"201-created",level:4},{value:"202 Accepted",id:"202-accepted",level:4},{value:"204 No Content",id:"204-no-content",level:4},{value:"3xx Redirection Codes",id:"3xx-redirection-codes",level:3},{value:"301 Moved Permanently",id:"301-moved-permanently",level:4},{value:"302 Found / 307 Temporary Redirect",id:"302-found--307-temporary-redirect",level:4},{value:"4xx Client Error Codes",id:"4xx-client-error-codes",level:3},{value:"400 Bad Request",id:"400-bad-request",level:4},{value:"401 Unauthorized",id:"401-unauthorized",level:4},{value:"403 Forbidden",id:"403-forbidden",level:4},{value:"404 Not Found",id:"404-not-found",level:4},{value:"409 Conflict",id:"409-conflict",level:4},{value:"429 Too Many Requests",id:"429-too-many-requests",level:4},{value:"405 Method Not Allowed",id:"405-method-not-allowed",level:4},{value:"5xx Server Error Codes",id:"5xx-server-error-codes",level:3},{value:"500 Internal Server Error",id:"500-internal-server-error",level:4},{value:"503 Service Unavailable",id:"503-service-unavailable",level:4},{value:"Testing Error Handling",id:"testing-error-handling",level:2},{value:"Test Domain Exceptions",id:"test-domain-exceptions",level:3},{value:"Test Validation Errors",id:"test-validation-errors",level:3},{value:"Production Deployment Checklist",id:"production-deployment-checklist",level:2},{value:"1. Exception Handler Configuration",id:"1-exception-handler-configuration",level:3},{value:"2. Logging Configuration",id:"2-logging-configuration",level:3},{value:"3. Monitoring Integration",id:"3-monitoring-integration",level:3},{value:"Summary",id:"summary",level:2},{value:"Production-Grade Error Handling Principles",id:"production-grade-error-handling-principles",level:3},{value:"Key Benefits",id:"key-benefits",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"production-grade-error-handling-and-status-codes",children:"Production-Grade Error Handling and Status Codes"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Proper error handling and status code usage are essential for building reliable, audit-safe APIs. This document covers production-ready patterns for handling errors and using HTTP status codes correctly in Django REST Framework."}),"\n",(0,i.jsx)(n.h2,{id:"core-principles",children:"Core Principles"}),"\n",(0,i.jsx)(n.h3,{id:"1-single-error-response-format",children:"1. Single Error Response Format"}),"\n",(0,i.jsx)(n.p,{children:"All API errors must follow one canonical format:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": {\n    "code": "ERROR_CODE",\n    "message": "Human-readable error message",\n    "fields": null\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"2-thin-views-rich-services",children:"2. Thin Views, Rich Services"}),"\n",(0,i.jsx)(n.p,{children:"Views should never contain business try/except blocks. Move business logic to service layers."}),"\n",(0,i.jsx)(n.h3,{id:"3-machine-readable-error-codes",children:"3. Machine-Readable Error Codes"}),"\n",(0,i.jsx)(n.p,{children:"Every error must have a stable, machine-readable code that never changes."}),"\n",(0,i.jsx)(n.h3,{id:"4-safe-logging-practices",children:"4. Safe Logging Practices"}),"\n",(0,i.jsx)(n.p,{children:"Log identifiers, never payloads. Protect sensitive data."}),"\n",(0,i.jsx)(n.h2,{id:"http-status-codes",children:"HTTP Status Codes"}),"\n",(0,i.jsx)(n.h3,{id:"understanding-status-code-categories",children:"Understanding Status Code Categories"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"1xx (Informational):"})," Request received, continuing process"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"2xx (Success):"})," Request successfully received, understood, and accepted"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"3xx (Redirection):"})," Further action needed to complete request"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"4xx (Client Error):"})," Request contains bad syntax or cannot be fulfilled"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"5xx (Server Error):"})," Server failed to fulfill valid request"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"status-code-strategy",children:"Status Code Strategy"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use 400 for all validation errors."})," Don't mix 400 and 422. Choose one and enforce it globally."]}),"\n",(0,i.jsx)(n.h2,{id:"production-grade-error-handling",children:"Production-Grade Error Handling"}),"\n",(0,i.jsx)(n.h3,{id:"1-domain-exceptions-business-logic-errors",children:"1. Domain Exceptions (Business Logic Errors)"}),"\n",(0,i.jsx)(n.p,{children:"Define domain-specific exceptions that carry error codes and status codes."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# core/exceptions.py\nclass DomainError(Exception):\n    """Base class for all business logic errors"""\n    code = "DOMAIN_ERROR"\n    status_code = 400\n    \n    def __init__(self, message=None):\n        self.message = message or self.__class__.__name__.replace(\'_\', \' \').title()\n        super().__init__(self.message)\n\nclass ArticleAlreadyPublished(DomainError):\n    code = "ARTICLE_ALREADY_PUBLISHED"\n    status_code = 409\n\nclass ArticleNotFound(DomainError):\n    code = "ARTICLE_NOT_FOUND"\n    status_code = 404\n\nclass InvalidArticleStatus(DomainError):\n    code = "INVALID_ARTICLE_STATUS"\n    status_code = 400\n\nclass PermissionDenied(DomainError):\n    code = "PERMISSION_DENIED"\n    status_code = 403\n'})}),"\n",(0,i.jsx)(n.h3,{id:"2-service-layer-no-tryexcept-in-views",children:"2. Service Layer (No Try/Except in Views)"}),"\n",(0,i.jsx)(n.p,{children:"Move all business logic to service layers. Views should be thin and exception-free."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# articles/services.py\nfrom core.exceptions import ArticleAlreadyPublished, ArticleNotFound, InvalidArticleStatus\n\ndef publish_article(article, user):\n    """Publish an article with business rules"""\n    if article.author != user:\n        raise PermissionDenied("You can only publish your own articles")\n    \n    if article.published:\n        raise ArticleAlreadyPublished("Article is already published")\n    \n    if article.status not in [\'draft\', \'review\']:\n        raise InvalidArticleStatus(f"Cannot publish article with status: {article.status}")\n    \n    article.published = True\n    article.status = \'published\'\n    article.published_at = timezone.now()\n    article.save()\n    \n    return article\n\ndef get_article_for_user(article_id, user):\n    """Get article with permission check"""\n    try:\n        article = Article.objects.get(id=article_id)\n    except Article.DoesNotExist:\n        raise ArticleNotFound("Article not found")\n    \n    if article.author != user and not article.published:\n        raise PermissionDenied("You don\'t have permission to view this article")\n    \n    return article\n'})}),"\n",(0,i.jsx)(n.h3,{id:"3-thin-views-no-business-tryexcept",children:"3. Thin Views (No Business Try/Except)"}),"\n",(0,i.jsx)(n.p,{children:"Views should orchestrate, not handle business logic."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# articles/api/views.py\nfrom articles.services import publish_article, get_article_for_user\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    """Thin viewset - no business try/except"""\n    \n    @action(detail=True, methods=[\'post\'])\n    def publish(self, request, pk=None):\n        article = self.get_object()\n        published_article = publish_article(article, request.user)\n        return Response(self.get_serializer(published_article).data)\n    \n    def retrieve(self, request, pk=None):\n        article = get_article_for_user(pk, request.user)\n        return Response(self.get_serializer(article).data)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"4-global-exception-handler-single-error-format",children:"4. Global Exception Handler (Single Error Format)"}),"\n",(0,i.jsx)(n.p,{children:"One canonical error response format for all errors."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# core/exception_handler.py\nfrom rest_framework.views import exception_handler\nfrom rest_framework.response import Response\nfrom rest_framework import status\nfrom core.exceptions import DomainError\n\ndef api_exception_handler(exc, context):\n    """Global exception handler with single error format"""\n    \n    # Domain errors (business logic)\n    if isinstance(exc, DomainError):\n        return Response(\n            {\n                "error": {\n                    "code": exc.code,\n                    "message": exc.message,\n                    "fields": None\n                }\n            },\n            status=exc.status_code\n        )\n    \n    # DRF validation errors\n    response = exception_handler(exc, context)\n    if response is not None:\n        return Response(\n            {\n                "error": {\n                    "code": "VALIDATION_ERROR",\n                    "message": "Invalid input",\n                    "fields": response.data\n                }\n            },\n            status=response.status_code\n        )\n    \n    # Unhandled exceptions (500)\n    return Response(\n        {\n            "error": {\n                "code": "INTERNAL_SERVER_ERROR",\n                "message": "Something went wrong"\n            }\n        },\n        status=status.HTTP_500_INTERNAL_SERVER_ERROR\n    )\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# settings.py\nREST_FRAMEWORK = {\n    "EXCEPTION_HANDLER": "core.exception_handler.api_exception_handler"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"5-standard-error-codes",children:"5. Standard Error Codes"}),"\n",(0,i.jsx)(n.p,{children:"Use consistent, machine-readable error codes across your API."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# core/error_codes.py\nclass ErrorCodes:\n    # Authentication & Authorization\n    AUTH_REQUIRED = "AUTH_REQUIRED"\n    PERMISSION_DENIED = "PERMISSION_DENIED"\n    INVALID_TOKEN = "INVALID_TOKEN"\n    TOKEN_EXPIRED = "TOKEN_EXPIRED"\n    \n    # Validation\n    VALIDATION_ERROR = "VALIDATION_ERROR"\n    INVALID_INPUT = "INVALID_INPUT"\n    MISSING_FIELD = "MISSING_FIELD"\n    \n    # Resources\n    RESOURCE_NOT_FOUND = "RESOURCE_NOT_FOUND"\n    ARTICLE_NOT_FOUND = "ARTICLE_NOT_FOUND"\n    USER_NOT_FOUND = "USER_NOT_FOUND"\n    \n    # Business Logic\n    ARTICLE_ALREADY_PUBLISHED = "ARTICLE_ALREADY_PUBLISHED"\n    INVALID_ARTICLE_STATUS = "INVALID_ARTICLE_STATUS"\n    DUPLICATE_RESOURCE = "DUPLICATE_RESOURCE"\n    \n    # Rate Limiting\n    RATE_LIMITED = "RATE_LIMITED"\n    TOO_MANY_REQUESTS = "TOO_MANY_REQUESTS"\n    \n    # Server Errors\n    INTERNAL_SERVER_ERROR = "INTERNAL_SERVER_ERROR"\n    SERVICE_UNAVAILABLE = "SERVICE_UNAVAILABLE"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"6-safe-logging-practices",children:"6. Safe Logging Practices"}),"\n",(0,i.jsx)(n.p,{children:"Log identifiers, never payloads. Protect sensitive data."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# core/logging.py\nimport logging\nfrom django.conf import settings\n\nlogger = logging.getLogger(__name__)\n\ndef log_error(message, **kwargs):\n    """Safe logging with identifiers only"""\n    safe_kwargs = {k: v for k, v in kwargs.items() if k not in [\'password\', \'token\', \'secret\']}\n    logger.error(message, extra=safe_kwargs)\n\ndef log_business_error(exc, request=None, **context):\n    """Log business errors safely"""\n    log_error(\n        f"Business error: {exc.code}",\n        error_code=exc.code,\n        error_message=exc.message,\n        user_id=request.user.id if request and hasattr(request, \'user\') else None,\n        **context\n    )\n\n# Usage in services\ndef publish_article(article, user):\n    try:\n        # ... business logic\n        pass\n    except DomainError as exc:\n        log_business_error(exc, request=user, article_id=article.id)\n        raise\n'})}),"\n",(0,i.jsx)(n.h3,{id:"7-error-response-examples",children:"7. Error Response Examples"}),"\n",(0,i.jsx)(n.p,{children:"All errors follow the same format:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'// Validation Error\n{\n  "error": {\n    "code": "VALIDATION_ERROR",\n    "message": "Invalid input",\n    "fields": {\n      "title": ["Title must be at least 5 characters long"],\n      "email": ["Enter a valid email address"]\n    }\n  }\n}\n\n// Business Logic Error\n{\n  "error": {\n    "code": "ARTICLE_ALREADY_PUBLISHED",\n    "message": "Article is already published",\n    "fields": null\n  }\n}\n\n// Permission Error\n{\n  "error": {\n    "code": "PERMISSION_DENIED",\n    "message": "You do not have permission to perform this action",\n    "fields": null\n  }\n}\n\n// Not Found Error\n{\n  "error": {\n    "code": "ARTICLE_NOT_FOUND",\n    "message": "Article not found",\n    "fields": null\n  }\n}\n\n// Server Error\n{\n  "error": {\n    "code": "INTERNAL_SERVER_ERROR",\n    "message": "Something went wrong",\n    "fields": null\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"common-status-codes",children:"Common Status Codes"}),"\n",(0,i.jsx)(n.h3,{id:"2xx-success-codes",children:"2xx Success Codes"}),"\n",(0,i.jsx)(n.h4,{id:"200-ok",children:"200 OK"}),"\n",(0,i.jsx)(n.p,{children:"General success response for GET, PUT, PATCH, or DELETE."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rest_framework import status\nfrom rest_framework.response import Response\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    def retrieve(self, request, pk=None):\n        article = self.get_object()\n        serializer = self.get_serializer(article)\n        return Response(serializer.data, status=status.HTTP_200_OK)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"201-created",children:"201 Created"}),"\n",(0,i.jsx)(n.p,{children:"Resource successfully created (POST requests)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def create(self, request, *args, **kwargs):\n    serializer = self.get_serializer(data=request.data)\n    serializer.is_valid(raise_exception=True)\n    instance = serializer.save()\n    \n    headers = {\n        'Location': reverse('article-detail', args=[instance.id], request=request)\n    }\n    \n    return Response(\n        serializer.data,\n        status=status.HTTP_201_CREATED,\n        headers=headers\n    )\n"})}),"\n",(0,i.jsx)(n.h4,{id:"202-accepted",children:"202 Accepted"}),"\n",(0,i.jsx)(n.p,{children:"Request accepted for processing but not completed (async operations)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from celery import shared_task\n\n@shared_task\ndef generate_report(article_id):\n    # Long-running task\n    pass\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    @action(detail=True, methods=['post'])\n    def generate_report(self, request, pk=None):\n        article = self.get_object()\n        \n        # Queue async task\n        task = generate_report.delay(article.id)\n        \n        return Response(\n            {\n                'task_id': task.id,\n                'status': 'PENDING',\n                'status_url': f'/api/tasks/{task.id}/'\n            },\n            status=status.HTTP_202_ACCEPTED\n        )\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Async processing"}),"\n",(0,i.jsx)(n.li,{children:"Batch operations"}),"\n",(0,i.jsx)(n.li,{children:"Long-running tasks"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"204-no-content",children:"204 No Content"}),"\n",(0,i.jsx)(n.p,{children:"Successful request with no response body (typically DELETE)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def destroy(self, request, pk=None):\n    article = self.get_object()\n    article.delete()\n    return Response(status=status.HTTP_204_NO_CONTENT)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3xx-redirection-codes",children:"3xx Redirection Codes"}),"\n",(0,i.jsx)(n.h4,{id:"301-moved-permanently",children:"301 Moved Permanently"}),"\n",(0,i.jsx)(n.p,{children:"Resource permanently moved to new URL."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from django.http import HttpResponsePermanentRedirect\n\ndef old_endpoint(request):\n    return HttpResponsePermanentRedirect('/api/v2/articles/')\n"})}),"\n",(0,i.jsx)(n.h4,{id:"302-found--307-temporary-redirect",children:"302 Found / 307 Temporary Redirect"}),"\n",(0,i.jsx)(n.p,{children:"Resource temporarily at different URL."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rest_framework.response import Response\n\ndef temporary_endpoint(request):\n    response = Response(status=status.HTTP_307_TEMPORARY_REDIRECT)\n    response['Location'] = '/api/v2/articles/'\n    return response\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4xx-client-error-codes",children:"4xx Client Error Codes"}),"\n",(0,i.jsx)(n.h4,{id:"400-bad-request",children:"400 Bad Request"}),"\n",(0,i.jsx)(n.p,{children:"Invalid request syntax or validation errors. Use 400 for ALL validation errors."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Serializer validation (automatically handled by global exception handler)\nclass ArticleSerializer(serializers.ModelSerializer):\n    def validate_title(self, value):\n        if len(value) < 5:\n            raise serializers.ValidationError(\n                "Title must be at least 5 characters long"\n            )\n        return value\n\n# Response (formatted by global exception handler):\n{\n  "error": {\n    "code": "VALIDATION_ERROR",\n    "message": "Invalid input",\n    "fields": {\n      "title": ["Title must be at least 5 characters long"]\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"401-unauthorized",children:"401 Unauthorized"}),"\n",(0,i.jsx)(n.p,{children:"Authentication required or failed."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from rest_framework.permissions import IsAuthenticated\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    permission_classes = [IsAuthenticated]\n    \n    # Missing/invalid token returns (formatted by global exception handler):\n    {\n      "error": {\n        "code": "AUTH_REQUIRED",\n        "message": "Authentication credentials were not provided.",\n        "fields": null\n      }\n    }\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"401 vs 403:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"401:"})," User not authenticated (missing or invalid credentials)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"403:"})," User authenticated but lacks permission"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"403-forbidden",children:"403 Forbidden"}),"\n",(0,i.jsx)(n.p,{children:"Authenticated but not authorized."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from rest_framework.permissions import BasePermission\n\nclass IsOwnerOrReadOnly(BasePermission):\n    def has_object_permission(self, request, view, obj):\n        if request.method in permissions.SAFE_METHODS:\n            return True\n        return obj.author == request.user\n\n# Non-owner trying to edit returns (formatted by global exception handler):\n{\n  "error": {\n    "code": "PERMISSION_DENIED",\n    "message": "You do not have permission to perform this action",\n    "fields": null\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"404-not-found",children:"404 Not Found"}),"\n",(0,i.jsx)(n.p,{children:"Resource not found."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Handled by service layer (raises ArticleNotFound)\ndef get_article_for_user(article_id, user):\n    try:\n        article = Article.objects.get(id=article_id)\n    except Article.DoesNotExist:\n        raise ArticleNotFound("Article not found")\n    \n    return article\n\n# Response (formatted by global exception handler):\n{\n  "error": {\n    "code": "ARTICLE_NOT_FOUND",\n    "message": "Article not found",\n    "fields": null\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"409-conflict",children:"409 Conflict"}),"\n",(0,i.jsx)(n.p,{children:"Request conflicts with current state of resource."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Business logic error (handled by service layer)\ndef publish_article(article, user):\n    if article.published:\n        raise ArticleAlreadyPublished("Article is already published")\n    \n    # ... publish logic\n    return article\n\n# Response (formatted by global exception handler):\n{\n  "error": {\n    "code": "ARTICLE_ALREADY_PUBLISHED",\n    "message": "Article is already published",\n    "fields": null\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"429-too-many-requests",children:"429 Too Many Requests"}),"\n",(0,i.jsx)(n.p,{children:"Rate limit exceeded."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from rest_framework.throttling import UserRateThrottle\n\nclass ArticleViewSet(viewsets.ModelViewSet):\n    throttle_classes = [UserRateThrottle]\n    \n    # Rate limit exceeded returns (formatted by global exception handler):\n    {\n      "error": {\n        "code": "RATE_LIMITED",\n        "message": "Request was throttled.",\n        "fields": null\n      }\n    }\n'})}),"\n",(0,i.jsx)(n.h4,{id:"405-method-not-allowed",children:"405 Method Not Allowed"}),"\n",(0,i.jsx)(n.p,{children:"HTTP method not supported for endpoint."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class ArticleViewSet(viewsets.ModelViewSet):\n    http_method_names = [\'get\', \'post\', \'patch\', \'delete\']  # No PUT\n    \n    # PUT request returns (formatted by global exception handler):\n    {\n      "error": {\n        "code": "METHOD_NOT_ALLOWED",\n        "message": "Method \\"PUT\\" not allowed.",\n        "fields": null\n      }\n    }\n'})}),"\n",(0,i.jsx)(n.h3,{id:"5xx-server-error-codes",children:"5xx Server Error Codes"}),"\n",(0,i.jsx)(n.h4,{id:"500-internal-server-error",children:"500 Internal Server Error"}),"\n",(0,i.jsx)(n.p,{children:"Unexpected server error. Never expose stack traces in production."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Handled by global exception handler\n# All unhandled exceptions return:\n{\n  "error": {\n    "code": "INTERNAL_SERVER_ERROR",\n    "message": "Something went wrong",\n    "fields": null\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important:"})," Never expose detailed error information in production responses. Use logging for debugging."]}),"\n",(0,i.jsx)(n.h4,{id:"503-service-unavailable",children:"503 Service Unavailable"}),"\n",(0,i.jsx)(n.p,{children:"Service temporarily unavailable."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from django.core.management.base import BaseCommand\nfrom rest_framework.response import Response\nfrom rest_framework import status\n\nclass MaintenanceModeMiddleware:\n    def __init__(self, get_response):\n        self.get_response = get_response\n    \n    def __call__(self, request):\n        if settings.MAINTENANCE_MODE:\n            return Response(\n                {\n                    "error": {\n                        "code": "SERVICE_UNAVAILABLE",\n                        "message": "Service temporarily unavailable",\n                        "fields": null\n                    }\n                },\n                status=status.HTTP_503_SERVICE_UNAVAILABLE\n            )\n        return self.get_response(request)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"testing-error-handling",children:"Testing Error Handling"}),"\n",(0,i.jsx)(n.h3,{id:"test-domain-exceptions",children:"Test Domain Exceptions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from rest_framework.test import APITestCase\nfrom core.exceptions import ArticleAlreadyPublished, ArticleNotFound\nfrom articles.services import publish_article\n\nclass ErrorHandlingTestCase(APITestCase):\n    def setUp(self):\n        self.user = UserFactory()\n        self.article = ArticleFactory(author=self.user, published=True)\n    \n    def test_publish_already_published_article(self):\n        """Test business logic error handling"""\n        with self.assertRaises(ArticleAlreadyPublished) as context:\n            publish_article(self.article, self.user)\n        \n        self.assertEqual(context.exception.code, "ARTICLE_ALREADY_PUBLISHED")\n        self.assertEqual(context.exception.status_code, 409)\n    \n    def test_publish_unauthorized_article(self):\n        """Test permission error handling"""\n        other_user = UserFactory()\n        other_article = ArticleFactory(author=other_user)\n        \n        with self.assertRaises(PermissionDenied) as context:\n            publish_article(other_article, self.user)\n        \n        self.assertEqual(context.exception.code, "PERMISSION_DENIED")\n        self.assertEqual(context.exception.status_code, 403)\n    \n    def test_api_error_response_format(self):\n        """Test API returns consistent error format"""\n        self.client.force_authenticate(user=self.user)\n        response = self.client.post(f\'/api/articles/{self.article.id}/publish/\')\n        \n        self.assertEqual(response.status_code, 409)\n        self.assertIn(\'error\', response.data)\n        self.assertEqual(response.data[\'error\'][\'code\'], \'ARTICLE_ALREADY_PUBLISHED\')\n        self.assertEqual(response.data[\'error\'][\'fields\'], None)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"test-validation-errors",children:"Test Validation Errors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class ValidationTestCase(APITestCase):\n    def test_validation_error_format(self):\n        \"\"\"Test validation errors return correct format\"\"\"\n        self.client.force_authenticate(user=UserFactory())\n        \n        response = self.client.post('/api/articles/', {\n            'title': 'short',  # Too short\n            'content': ''      # Required field missing\n        })\n        \n        self.assertEqual(response.status_code, 400)\n        self.assertIn('error', response.data)\n        self.assertEqual(response.data['error']['code'], 'VALIDATION_ERROR')\n        self.assertIn('fields', response.data['error'])\n        self.assertIn('title', response.data['error']['fields'])\n        self.assertIn('content', response.data['error']['fields'])\n"})}),"\n",(0,i.jsx)(n.h2,{id:"production-deployment-checklist",children:"Production Deployment Checklist"}),"\n",(0,i.jsx)(n.h3,{id:"1-exception-handler-configuration",children:"1. Exception Handler Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# settings.py - Production\nREST_FRAMEWORK = {\n    "EXCEPTION_HANDLER": "core.exception_handler.api_exception_handler",\n    # ... other settings\n}\n\n# Ensure DEBUG = False in production\nDEBUG = False\n'})}),"\n",(0,i.jsx)(n.h3,{id:"2-logging-configuration",children:"2. Logging Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# settings.py - Production logging\nLOGGING = {\n    'version': 1,\n    'disable_existing_loggers': False,\n    'formatters': {\n        'json': {\n            'class': 'pythonjsonlogger.jsonlogger.JsonFormatter',\n            'format': '%(asctime)s %(name)s %(levelname)s %(message)s'\n        }\n    },\n    'handlers': {\n        'file': {\n            'class': 'logging.handlers.RotatingFileHandler',\n            'filename': '/var/log/django/api.log',\n            'maxBytes': 1024*1024*15,  # 15MB\n            'backupCount': 10,\n            'formatter': 'json'\n        },\n        'sentry': {\n            'level': 'ERROR',\n            'class': 'sentry_sdk.integrations.django.SentryHandler',\n        },\n    },\n    'loggers': {\n        'django': {\n            'handlers': ['file', 'sentry'],\n            'level': 'INFO',\n            'propagate': False,\n        },\n        'core': {\n            'handlers': ['file', 'sentry'],\n            'level': 'INFO',\n            'propagate': False,\n        },\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-monitoring-integration",children:"3. Monitoring Integration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# core/monitoring.py\nimport sentry_sdk\nfrom sentry_sdk.integrations.django import DjangoIntegration\n\nsentry_sdk.init(\n    dsn=settings.SENTRY_DSN,\n    integrations=[DjangoIntegration()],\n    traces_sample_rate=0.1,\n    send_default_pii=False  # Don\'t send PII\n)\n\n# Custom error context\ndef add_error_context(exc, request):\n    if hasattr(request, \'user\') and request.user.is_authenticated:\n        sentry_sdk.set_user({\n            "id": request.user.id,\n            "email": request.user.email\n        })\n    \n    sentry_sdk.set_tag("error_code", getattr(exc, \'code\', \'UNKNOWN\'))\n    sentry_sdk.set_context("request", {\n        "path": request.path,\n        "method": request.method,\n        "user_agent": request.META.get(\'HTTP_USER_AGENT\')\n    })\n'})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.h3,{id:"production-grade-error-handling-principles",children:"Production-Grade Error Handling Principles"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Single Error Format"}),": All errors follow the same structure with code, message, and fields"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Thin Views"}),": No business try/except in views - move to service layers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Domain Exceptions"}),": Business logic errors raise specific exceptions with codes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Global Handler"}),": One place handles all error formatting"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Safe Logging"}),": Log identifiers, never sensitive data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consistent Status Codes"}),": Use 400 for all validation errors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Machine-Readable Codes"}),": Stable error codes for frontend/mobile clients"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Production Safety"}),": Never expose stack traces or internal details"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"key-benefits",children:"Key Benefits"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Frontend-Friendly"}),": Consistent error format across all endpoints"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mobile-Ready"}),": Machine-readable codes for mobile apps"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Audit-Safe"}),": Proper logging and monitoring"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scalable"}),": Clean separation of concerns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Maintainable"}),": Centralized error handling logic"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Following these patterns ensures your API is production-ready, secure, and provides excellent developer experience for API consumers."})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453(e,n,r){r.d(n,{R:()=>o,x:()=>l});var s=r(6540);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);